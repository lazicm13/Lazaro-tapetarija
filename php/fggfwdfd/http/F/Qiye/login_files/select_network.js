(function(b){var a={container:b(".goto"),panelTemplate:'			<div class="selectNetwork">				<div class="title">'+message.networkCheck+'</div>					<div class="isps f-cb">					</div>				</div>',panel:undefined,ispTemplate:'			<a href="#" class="isp">				<div class="name"></div>				<div class="status">'+message.connecting+"</div>			</a>",isps:{},knownAddress:{t:[message.telecom,"http://tp.127.net/cte/ttest"],c:[message.unicom,"http://cp.127.net/cte/ctest"],h:[message.hangzhou,"http://hzp.127.net/cte/hzp"]},entry:{t:"tentry.qiye.163.com",c:"centry.qiye.163.com",h:"hentry.qiye.163.com"},availableAddress:[],recordStartTime:{},duration:{},dnsReady:false,selectManually:undefined,scripts:[],reset:function(){if(!this.panel){this.panel=b(this.panelTemplate);this.panel.hide().click(function(d){d.stopPropagation()});this.panel.appendTo(this.container);var c=this.panel;b(document.body).click(function(){c.hide()})}else{this.panel.find(".isps").empty()}this.availableAddress=[];this.recordStartTime={};this.duration={}},clickIsp:function(d){d.preventDefault();var c=b(d.currentTarget);this.panel.find(".isp").removeClass("selected");c.addClass("selected");this.setBestIsp(c.attr("name"));this.selectManually=c.attr("name");this.panel.hide()},setBestIsp:function(c){var d=b("#loginform").attr("action");d=d.replace(/[tch]?entry.qiye.163.com/,this.entry[c]);b("#loginform").attr("action",d);b("#ch").val(c);b("#selectNetwork").text(message.server+this.knownAddress[c][0])},showPanel:function(g){this.reset();g=g.split(",");for(var e=0;e<g.length;e++){var d=g[e],h=this.knownAddress[d],f=b(this.ispTemplate);this.availableAddress.push(d);f.attr("name",d).find(".name").text(h[0]);if(d===this.selectManually){f.addClass("selected")}if(e===g.length-1){f.addClass("isp-1")}this.isps[d]=f;this.panel.find(".isps").append(f)}this.panel.css("width",101*g.length-1);this.panel.find(".isp").click(function(i){a.clickIsp(i)});var c=this.container;this.panel.css("top",function(){return 0}).css("left",function(){return(b(c).outerWidth()-b(this).outerWidth())/2}).show();if(b.browser.msie&&b.browser.version.indexOf("6")!=-1){this.panel.css("left",function(){return(b(c).outerWidth()-b(this).outerWidth())/2-67})}this.detectNetwork()},detectNetwork:function(){if(this.scripts){b.each(this.scripts,function(g,h){h.remove()})}for(var e=0;e<this.availableAddress.length;e++){var d=this.availableAddress[e],f=new Date();this.recordStartTime[d]=new Date();var c=b("<script><\/script>").attr("type","text/javascript").attr("src",this.knownAddress[d][1]+"?"+f.getTime());this.scripts.push(c);c.appendTo(document.body)}},detectNetworkCB:function(e){var c;switch(e){case 0:c="t";break;case 1:c="c";break;case 2:c="h";break}var f=new Date().getTime()-this.recordStartTime[c].getTime();this.duration[c]=f;this.isps[c].find(".status").text(f+"ms");var g=[];for(var c in this.duration){if(this.duration.hasOwnProperty(c)){g.push(this.duration[c])}}var d=Math.min.apply(Math,g);for(var c in this.duration){if(this.duration.hasOwnProperty(c)){if(this.duration[c]===d){this.isps[c].find(".status").addClass("best");if(!this.selectManually){this.panel.find(".isp").removeClass("selected");this.isps[c].addClass("selected");this.setBestIsp(c)}break}}}}};if(window.addresses){window.fSpeedTest=function(c){a.detectNetworkCB(c)};window.fSpd=function(c){a.detectNetworkCB(2)};b("#selectNetwork").click(function(c){c.preventDefault();c.stopPropagation();a.showPanel(window.addresses)})}})(jQuery);